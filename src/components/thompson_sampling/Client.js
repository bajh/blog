export const BlogPostClient = {
    distributions: {
        "0d6684dad20fc2cd17fbe211f7eda58a3ba51bc1": {
            "distribution": [0.00020959966464053644, 0.0004191993292810729, 0.0006287989939216094, 0.0008383986585621458, 0.0010479983232026824, 0.0012575979878432187, 0.0014671976524837553, 0.0016767973171242915, 0.0018863969817648279, 0.0020959966464053643, 0.0023055963110459004, 0.002515195975686437, 0.002724795640326973, 0.00293439530496751, 0.0031439949696080464, 0.003353594634248583, 0.00356319429888912, 0.0037727939635296566, 0.003982393628170193, 0.004191993292810729, 0.004401592957451266, 0.004611192622091803, 0.004820792286732339, 0.005030391951372877, 0.005239991616013412, 0.005449591280653949, 0.005659190945294486, 0.005868790609935022, 0.006078390274575559, 0.006287989939216095, 0.006497589603856632, 0.006707189268497169, 0.006916788933137705, 0.007126388597778242, 0.007335988262418778, 0.007545587927059315, 0.007755187591699852, 0.007964787256340389, 0.008174386920980926, 0.008383986585621462, 0.008593586250261999, 0.008803185914902536, 0.009012785579543072, 0.009222385244183609, 0.009431984908824145, 0.009641584573464682, 0.009851184238105219, 0.010060783902745755, 0.010270383567386292, 0.010479983232026827, 0.010689582896667363, 0.0108991825613079, 0.011108782225948436, 0.011318381890588973, 0.01152798155522951, 0.011737581219870046, 0.011947180884510583, 0.01215678054915112, 0.012366380213791656, 0.012575979878432193, 0.01278557954307273, 0.012995179207713266, 0.013204778872353802, 0.013414378536994339, 0.013623978201634877, 0.013833577866275414, 0.01404317753091595, 0.014252777195556487, 0.014462376860197024, 0.01467197652483756, 0.014881576189478097, 0.015091175854118634, 0.01530077551875917, 0.015510375183399707, 0.015719974848040243, 0.015929574512680778, 0.016139174177321317, 0.01634877384196185, 0.01655837350660239, 0.016767973171242925, 0.016977572835883463, 0.017187172500523998, 0.016977572835883463, 0.016767973171242925, 0.01655837350660239, 0.01634877384196185, 0.016139174177321317, 0.015929574512680778, 0.015719974848040243, 0.015510375183399707, 0.01530077551875917, 0.015091175854118634, 0.014881576189478097, 0.01467197652483756, 0.014462376860197024, 0.014252777195556487, 0.01404317753091595, 0.013833577866275414, 0.013623978201634877, 0.013414378536994339, 0.013204778872353802],
            "restaurant": {
                "id": "0d6684dad20fc2cd17fbe211f7eda58a3ba51bc1",
                "name": "Hanco's",
                "vicinity": "147 Montague Street, Brooklyn",
                "rating": 4.1,
                "color": "#C93756",
            },
        },
        "ae35d2239c3318e58eba028c034866e9c314b1fb": {
            "distribution": [0.00019758940920766636, 0.0003951788184153327, 0.000592768227622999, 0.0007903576368306655, 0.0009879470460383319, 0.0011855364552459983, 0.0013831258644536647, 0.001580715273661331, 0.001778304682868997, 0.0019758940920766633, 0.0021734835012843295, 0.002371072910491996, 0.0025686623196996623, 0.0027662517289073285, 0.002963841138114995, 0.003161430547322662, 0.0033590199565303284, 0.003556609365737995, 0.0037541987749456613, 0.003951788184153328, 0.004149377593360994, 0.004346967002568661, 0.004544556411776327, 0.004742145820983994, 0.00493973523019166, 0.005137324639399326, 0.005334914048606993, 0.00553250345781466, 0.005730092867022326, 0.005927682276229993, 0.00612527168543766, 0.006322861094645326, 0.006520450503852992, 0.006718039913060659, 0.006915629322268325, 0.007113218731475992, 0.0073108081406836585, 0.007508397549891325, 0.007705986959098992, 0.007903576368306658, 0.008101165777514324, 0.008298755186721992, 0.008496344595929657, 0.008693934005137325, 0.00889152341434499, 0.009089112823552657, 0.009286702232760324, 0.00948429164196799, 0.009681881051175657, 0.009879470460383323, 0.010077059869590989, 0.010274649278798656, 0.010472238688006322, 0.010669828097213988, 0.010867417506421655, 0.011065006915629321, 0.011262596324836989, 0.011460185734044654, 0.011657775143252322, 0.011855364552459988, 0.012052953961667655, 0.012250543370875321, 0.012448132780082987, 0.012645722189290654, 0.01284331159849832, 0.013040901007705987, 0.013238490416913653, 0.01343607982612132, 0.013633669235328987, 0.013831258644536652, 0.01402884805374432, 0.014226437462951986, 0.014424026872159653, 0.014621616281367319, 0.014819205690574986, 0.015016795099782652, 0.01521438450899032, 0.015411973918197985, 0.015609563327405651, 0.015807152736613317, 0.016004742145820986, 0.016202331555028652, 0.016399920964236318, 0.016597510373443983, 0.016795099782651653, 0.01699268919185932, 0.017190278601066984, 0.01738786801027465, 0.017585457419482316, 0.017783046828689985, 0.01798063623789765, 0.018178225647105316, 0.01798063623789765, 0.017783046828689985, 0.017585457419482316, 0.01738786801027465, 0.017190278601066984, 0.01699268919185932, 0.016795099782651653, 0.016597510373443983, 0.016399920964236318],
            "restaurant": {
                "id": "ae35d2239c3318e58eba028c034866e9c314b1fb",
                "name": "Yemen Caf\u00e9",
                "vicinity": "176 Atlantic Avenue, New York",
                "rating": 4.6,
                "color": "#317589",
            },
        },
        "eccf9cb47b11c83476886b835c2fa7909dd5af8e": {
            "distribution": [0.00020639834881320943, 0.00041279669762641887, 0.0006191950464396282, 0.0008255933952528377, 0.0010319917440660472, 0.0012383900928792566, 0.001444788441692466, 0.0016511867905056755, 0.0018575851393188847, 0.002063983488132094, 0.0022703818369453036, 0.0024767801857585128, 0.002683178534571722, 0.0028895768833849316, 0.0030959752321981413, 0.003302373581011351, 0.0035087719298245606, 0.00371517027863777, 0.0039215686274509795, 0.0041279669762641896, 0.004334365325077399, 0.004540763673890609, 0.004747162022703818, 0.004953560371517027, 0.0051599587203302365, 0.005366357069143447, 0.005572755417956656, 0.005779153766769866, 0.005985552115583075, 0.006191950464396284, 0.006398348813209494, 0.006604747162022704, 0.006811145510835914, 0.007017543859649123, 0.007223942208462333, 0.007430340557275542, 0.007636738906088752, 0.007843137254901962, 0.008049535603715172, 0.00825593395252838, 0.00846233230134159, 0.0086687306501548, 0.00887512899896801, 0.00908152734778122, 0.009287925696594429, 0.009494324045407638, 0.009700722394220849, 0.009907120743034058, 0.010113519091847267, 0.010319917440660476, 0.010526315789473686, 0.010732714138286895, 0.010939112487100104, 0.011145510835913313, 0.011351909184726524, 0.011558307533539734, 0.011764705882352943, 0.011971104231166152, 0.012177502579979363, 0.012383900928792572, 0.012590299277605781, 0.01279669762641899, 0.0130030959752322, 0.01320949432404541, 0.01341589267285862, 0.01362229102167183, 0.013828689370485038, 0.01403508771929825, 0.014241486068111459, 0.014447884416924668, 0.014654282765737877, 0.014860681114551086, 0.015067079463364297, 0.015273477812177506, 0.015479876160990716, 0.015686274509803925, 0.015892672858617136, 0.016099071207430343, 0.016305469556243554, 0.016511867905056765, 0.016718266253869973, 0.016924664602683184, 0.01713106295149639, 0.017337461300309602, 0.01713106295149639, 0.016924664602683184, 0.016718266253869973, 0.016511867905056765, 0.016305469556243554, 0.016099071207430343, 0.015892672858617136, 0.015686274509803925, 0.015479876160990716, 0.015273477812177506, 0.015067079463364297, 0.014860681114551086, 0.014654282765737877, 0.014447884416924668, 0.014241486068111459, 0.01403508771929825, 0.013828689370485038],
            "restaurant": {
                "id": "eccf9cb47b11c83476886b835c2fa7909dd5af8e",
                "name": "Sophie's Cuban Cuisine",
                "vicinity": "27 Smith Street, Brooklyn",
                "rating": 4.2,
                "color": "#26A65B",
            },
        }
    },

    getDistributions: () => {
        console.log('getting distributions!', BlogPostClient.distributions)
        return Promise.resolve(Object.values(BlogPostClient.distributions))
    },

    getRecommendation: () => {
        const distributions = Object.values(BlogPostClient.distributions)
        const probabilities = distributions.map((d) => {
            let sum = 0
            let r = Math.random()
            for (let i = 0; i < d.distribution.length; i++) {
                sum += d.distribution[i]
                if(r <= sum) {
                    return i
                }
            }
            return 0
        })

        let selection = probabilities.reduce(
            (acc, p, i) => p > acc.p ? {i, p} : acc, { i: -1, p: 0}
        )
        let summary = {}
        for (let i = 0; i < probabilities.length; i++) {
            summary[distributions[i].restaurant.id] = probabilities[i]
        }

        return Promise.resolve({
            "restaurant": distributions[selection.i].restaurant,
            "probabilities": summary,
        })
    },

    update: (id, observation) => {
        let jointProbabilities = []
        const distribution = BlogPostClient.distributions[id].distribution
        for (let p = 0; p < distribution.length; p++) {
            let likelihoodOfObservation = observation ? p / 100.0 : 1 - p / 100.0
            jointProbabilities.push(likelihoodOfObservation * distribution[p])
        }
        const normalizingConstant = jointProbabilities.reduce((acc, p) => acc + p, 0)
        BlogPostClient.distributions[id].distribution = jointProbabilities.map((p) => p / normalizingConstant)

        return Promise.resolve({})
    },

}
